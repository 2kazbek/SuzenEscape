# Игровая платформа SuzenEscape

Призвана для обучения в нестандартной форме командам Linux.
В готовом и развернутом виде поиграть можно тут: [escape.myctf.ru](http://escape.myctf.ru)

Этот репозиторий предназначен именно для разработки! Если вы совсем-совсем новичок в Linux, пробуйте сначала поиграть,
а потом уже заняться разбором платформы и созданию новых заданий.

## Структура

1) **ansible** предназначена для выкатки платформы на некоторый игровой сервер
2) **chain** содержит данные для сборки уровней
3) **suzen_website** содержит веб интерфейс для игры (жюрейная система не является открытым продуктом и не входит в этот репозиторий)

## БЫСТРЫЙ СТАРТ

### Требования к системе

* Ваша операционная система должна поддерживать 64-разрядные виртуальные машины.
* Теоретически платформу можн поднять на любой ОС, которая поддерживает `VirtualBox` и `Vagrant`, но проверялось только на `Debian` и `Ubuntu`

### Порядок действий

* Установить следующий набор ПО:
  * [vagrant](https://www.vagrantup.com/downloads.html)
  * [virtualbox](https://www.virtualbox.org/wiki/Linux_Downloads)
  * rsync
  * ansible
* Выполнить поднятие виртуальной машины

  ```shellsession
  vagrant up
  ```

* В случае получения ошибки выполнить команду:

  ```shellsession
  vagrant provision
  ```

* Платформа развернута и готова. Задания доступы через `ssh`, где `XX` - номер уровня

  ```shellsession
  ssh -p 2222 suzenXX@127.0.0.1
  ```

* Доступ к веб интерфейсу:

  ```text
  http://127.0.0.1:8080
  ```

## Сборка

Сборку осуществляет корневой скрипт `build.py`, который принимает в качестве аргумента номер собираемого уровня. Аргумент может быть ключевым словом `all` — сборка всех уровней, либо перечисление номеров через пробел.

* Выполнить сборку всех уровней:

  ```shellsession
  ./build.py all
  ```

* Выполнить сборку определенных уровней:

  ```shellsession
  ./build.py 1 3 7
  ```

* Сборка веб-интерфейса:

  ```shellsession
  docker build -t 127.0.0.1:5000/suzenescape/web . && docker push 127.0.0.1:5000/suzenescape/web
  ```

## Registry и системные контейнеры

В случае если вы хотите разворачивать платформу с использованием стороннего docker registry, укажите его в
`ansible/values.yaml` в переменной `docker_registry`.

Также в рамках перехода на единый сборщик, существует еще системный контейнер: `bykva/busybinaries`,
он собирается в директории `busybox-custom`. Я разместил его на Docker Hub для уменьшения количества шагов в быстром старте.

## Используемые переменные

Все переменные проекта собраны в файле `ansible/values.yaml`

TODO: описание переменных

## Виды задач

* Задачи с флагом внутри: флаг дается за то что игрок догадался куда смотреть или выполнил набор действий,
  который привел его к флагу.
* Задачи с внешней проверкой: используется `cronjob`, которые прописываются в `ansible\templates`.
  (Также нужно прописать в `site.yaml`). Согласно cron будет выполняться достижение некоторого заданного состояния,
  за который игроку обещан флаг. Состояние и проверка выдумываются автором такого задания.
* Задачи с подключением к стороннему контейнеру. см таски `5` и `9`.
